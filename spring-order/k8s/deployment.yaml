---
apiVersion: "v1"
kind: "ServiceAccount"
metadata:
  annotations:
    app.quarkus.io/vcs-url: "https://github.com/lfcortes12/java-cloud-framework-comparison.git"
    app.quarkus.io/build-timestamp: "2020-06-19 - 11:00:11 +0000"
    app.quarkus.io/commit-id: "bd1ae4cdbec0dd2c0efd0156420ed0c75740acd5"
  labels:
    app.kubernetes.io/name: "spring-order"
    app.kubernetes.io/version: "0.3"
    prometheus.io/scrape: "true"
  name: "spring-order"
  
---

apiVersion: "rbac.authorization.k8s.io/v1"
kind: "RoleBinding"
metadata:
  annotations:
    app.quarkus.io/vcs-url: "https://github.com/lfcortes12/java-cloud-framework-comparison.git"
    app.quarkus.io/build-timestamp: "2020-06-19 - 11:00:11 +0000"
    app.quarkus.io/commit-id: "bd1ae4cdbec0dd2c0efd0156420ed0c75740acd5"
  labels:
    app.kubernetes.io/name: "spring-order"
    app.kubernetes.io/version: "0.3"
    prometheus.io/scrape: "true"
  name: "spring-order:view"
roleRef:
  kind: "ClusterRole"
  apiGroup: "rbac.authorization.k8s.io"
  name: "view"
subjects:
- kind: "ServiceAccount"
  name: "spring-order"
  
---
apiVersion: v1
kind: Service
metadata:
  name: spring-order
  labels:
    app: spring-order
spec:
  type: LoadBalancer
  ports:
    - port: 8080
      targetPort: 8080
      protocol: TCP
  selector:
    app: spring-order

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: spring-order
  labels:
    app: spring-order
spec:
  replicas: 1
  selector:
    matchLabels:
      app: spring-order
  template:
    metadata:
      labels:
        app: spring-order
    spec:
      serviceAccount: "spring-order"
      containers:
        - name: spring-order
          image: luiscortes/spring-order:0.6
          imagePullPolicy: Always
          env:
#            - name: CLOUD_CONFIG_ENDPOINT
#              value: http://book-store-registry-server:8761/config/
#            - name: CLOUD_CONFIG_LABEL
#              value: azure-kubernates
            - name: JAVA_TOOL_OPTIONS
              value: -Dspring.profiles.active=rancher -agentlib:jdwp=transport=dt_socket,server=y,address=8000,suspend=n,quiet=y
          ports:
            - containerPort: 8080
          readinessProbe:
            httpGet:
              path: "/spring/actuator/health/readiness"
              port: 8080
              scheme: "HTTP"
            failureThreshold: 3
            initialDelaySeconds: 16
            periodSeconds: 14
            timeoutSeconds: 14
            successThreshold: 1
          livenessProbe:
            httpGet:
              path: "/spring/actuator/health/liveness"
              port: 8080
              scheme: "HTTP"
            failureThreshold: 3
            initialDelaySeconds: 12
            periodSeconds: 30
            timeoutSeconds: 10
            successThreshold: 1

---


apiVersion: "extensions/v1beta1"
kind: "Ingress"
metadata:
  labels:
    app.kubernetes.io/name: "spring-order"
    app.kubernetes.io/version: "v3"
  name: "spring-order"

spec:
  rules:
    - host: ""
      http:
        paths:
          - path: /spring
            backend:
              serviceName: spring-order
              servicePort: 8080